<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `segment` mod in crate `webrender`."><meta name="keywords" content="rust, rustlang, rust-lang, segment"><title>webrender::segment - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script src="../../storage.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="shortcut icon" href="../../favicon.ico"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../webrender/index.html'><div class='logo-container'><img src='../../rust-logo.png' alt='logo'></div></a><p class='location'>Module segment</p><div class="sidebar-elems"><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li></ul></div><p class='location'><a href='../index.html'>webrender</a></p><script>window.sidebarCurrent = {name: 'segment', ty: 'mod', relpath: '../'};</script><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><a id="settings-menu" href="../../settings.html"><img src="../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../../src/webrender/segment.rs.html#5-1326' title='goto source code'>[src]</a></span><span class='in-band'>Module <a href='../index.html'>webrender</a>::<wbr><a class="mod" href=''>segment</a></span></h1><div class='docblock'><p>Primitive segmentation</p>
<h1 id="overview" class="section-header"><a href="#overview">Overview</a></h1>
<p>Segmenting is the process of breaking rectangular primitives into smaller rectangular
primitives in order to extract parts that could benefit from a fast paths.</p>
<p>Typically this is used to allow fully opaque segments to be rendered in the opaque
pass. For example when an opaque rectangle has a non-axis-aligned transform applied,
we usually have to apply some anti-aliasing around the edges which requires alpha
blending. By segmenting the edges out of the center of the primitive, we can keep a
large amount of pixels in the opaque pass.
Segmenting also lets us avoids rasterizing parts of clip masks that we know to have
no effect or to be fully masking. For example by segmenting the corners of a rounded
rectangle clip, we can optimize both rendering the mask and the primitive by only
rasterize the corners in the mask and not applying any clipping to the segments of
the primitive that don't overlap the borders. </p>
<p>It is a flexible system in the sense that different sources of segmentation (for
example two rounded rectangle clips) can affect the segmentation, and the possibility
to segment some effects such as specific clip kinds does not necessarily mean the
primitive will actually be segmented.</p>
<h2 id="segments-and-clipping" class="section-header"><a href="#segments-and-clipping">Segments and clipping</a></h2>
<p>Segments of a primitive can be either not clipped, fully clipped, or partially clipped.
In the first two case we don't need a clip mask. For each partially masked segments, a
mask is rasterized using a render task. All of the interesting steps happen during frame
building.</p>
<ul>
<li>The first step is to determine the segmentation and write the associated GPU data.
See <code>PrimitiveInstance::build_segments_if_needed</code> and <code>write_brush_segment_description</code>
in <code>prim_store/mod.rs</code> which uses the segment builder of this module.</li>
<li>The second step is to generate the mask render tasks.
See <code>BrushSegment::update_clip_task</code> and <code>RenderTask::new_mask</code>. For each segment that
needs a mask, the contribution of all clips that affect the segment is added to the
mask's render task.</li>
<li>Segments are assigned to batches (See <code>batch.rs</code>). Segments of a given primitive can
be assigned to different batches.</li>
</ul>
<p>See also the <a href="../clip/index.html"><code>clip</code> module documentation</a> for details about how clipping
information is represented.</p>
</div><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table><tr class='module-item'><td><a class="struct" href="struct.Event.html" title='webrender::segment::Event struct'>Event</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="struct" href="struct.Item.html" title='webrender::segment::Item struct'>Item</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="struct" href="struct.ItemFlags.html" title='webrender::segment::ItemFlags struct'>ItemFlags</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="struct" href="struct.ItemIndex.html" title='webrender::segment::ItemIndex struct'>ItemIndex</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="struct" href="struct.Segment.html" title='webrender::segment::Segment struct'>Segment</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="struct" href="struct.SegmentBuilder.html" title='webrender::segment::SegmentBuilder struct'>SegmentBuilder</a></td><td class='docblock-short'></td></tr></table><h2 id='enums' class='section-header'><a href="#enums">Enums</a></h2>
<table><tr class='module-item'><td><a class="enum" href="enum.EventKind.html" title='webrender::segment::EventKind enum'>EventKind</a></td><td class='docblock-short'></td></tr></table><h2 id='functions' class='section-header'><a href="#functions">Functions</a></h2>
<table><tr class='module-item'><td><a class="fn" href="fn.clamp.html" title='webrender::segment::clamp fn'>clamp</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="fn" href="fn.emit_segment_if_needed.html" title='webrender::segment::emit_segment_if_needed fn'>emit_segment_if_needed</a></td><td class='docblock-short'></td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../../";window.currentCrate = "webrender";</script><script src="../../main.js"></script><script defer src="../../search-index.js"></script></body></html>